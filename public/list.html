<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daftar ShortLink - Portal Premium</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .list-container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .header-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .stats-card {
            background: linear-gradient(145deg, #1e2a3e, #2a3b52);
            border-radius: 16px;
            padding: 25px;
            min-width: 250px;
            border-left: 4px solid #4facfe;
        }
        
        .stats-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #00f2fe;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .stats-label {
            font-size: 1rem;
            color: #b0b0b0;
            text-align: center;
        }
        
        .refresh-btn {
            background: linear-gradient(to right, #4facfe 0%, #00f2fe 100%);
            border: none;
            border-radius: 50px;
            padding: 15px 30px;
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s ease;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .refresh-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.5);
        }
        
        .refresh-btn:active {
            transform: translateY(1px);
        }
        
        .links-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .link-card {
            background: linear-gradient(145deg, #1e1e1e, #252525);
            border-radius: 16px;
            padding: 20px;
            transition: all 0.3s ease;
            border-left: 4px solid #00f2fe;
            position: relative;
            overflow: hidden;
        }
        
        .link-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
        }
        
        .link-number {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #00f2fe;
            color: #000;
            padding: 3px 10px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 0.8rem;
        }
        
        .link-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #fff;
            margin-bottom: 10px;
            padding-right: 60px;
        }
        
        .link-description {
            color: #b0b0b0;
            font-size: 0.9rem;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .link-date {
            color: #888;
            font-size: 0.8rem;
            margin-bottom: 20px;
        }
        
        .link-actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        
        .copy-btn {
            background: #4facfe;
            color: white;
        }
        
        .visit-btn {
            background: #00f2fe;
            color: #000;
            font-weight: 600;
        }
        
        .action-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }
        
        .loading {
            text-align: center;
            padding: 40px 20px;
            color: #4facfe;
        }
        
        .short-link {
            font-family: monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 8px 12px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #00f2fe;
            word-break: break-all;
        }
        
        @media (max-width: 768px) {
            .header-section {
                flex-direction: column;
                align-items: stretch;
            }
            
            .stats-card {
                width: 100%;
            }
            
            .links-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Background Effects -->
    <div class="bg-effects">
        <div class="bg-circle circle-1"></div>
        <div class="bg-circle circle-2"></div>
    </div>
    
    <!-- Particles -->
    <div class="particles" id="particles"></div>
    
    <!-- Main Content -->
    <div class="container list-container">
        <h1>Daftar ShortLink</h1>
        <p>Kelola semua tautan pendek yang telah Anda buat</p>
        
        <div class="header-section">
            <div class="stats-card">
                <div class="stats-number" id="activeLinksCount">0</div>
                <div class="stats-label">ShortLink Aktif</div>
            </div>
            
            <button class="refresh-btn" id="refreshBtn">
                <span>ðŸ”„</span> Refresh Daftar
            </button>
            <a href="/create" class="refresh-btn">BuatShortlink</a>
        </div>
        
        <div id="linksContainer">
            <div class="loading">
                <div class="spinner"></div>
                <p>Memuat daftar shortlink...</p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const linksContainer = document.getElementById('linksContainer');
            const activeLinksCount = document.getElementById('activeLinksCount');
            const refreshBtn = document.getElementById('refreshBtn');
            
            // Base URL
            const BASE_URL = window.location.origin;
            
            // Load links on page load
            loadLinks();
            
            // Refresh button
            refreshBtn.addEventListener('click', function() {
                // Add rotation animation
                refreshBtn.style.transform = 'rotate(360deg)';
                refreshBtn.style.transition = 'transform 0.5s ease';
                
                loadLinks();
                
                // Reset animation after a delay
                setTimeout(() => {
                    refreshBtn.style.transform = 'rotate(0deg)';
                }, 500);
            });
            
            // Function to load links
            async function loadLinks() {
                linksContainer.innerHTML = `
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Memuat daftar shortlink...</p>
                    </div>
                `;
                
                try {
                    const response = await fetch('/api/links');
                    const data = await response.json();
                    
                    if (data.success) {
                        displayLinks(data.data.links);
                        updateStats(data.data.links);
                    } else {
                        throw new Error(data.message || 'Gagal memuat data');
                    }
                } catch (error) {
                    linksContainer.innerHTML = `
                        <div class="empty-state">
                            <h3>Terjadi Error</h3>
                            <p>${error.message || 'Tidak dapat memuat daftar shortlink'}</p>
                            <p>Pastikan Anda terhubung ke internet dan coba lagi.</p>
                        </div>
                    `;
                }
            }
            
            // Function to display links
            function displayLinks(links) {
                // Filter only active links
                const activeLinks = links.filter(link => link.status === 'active');
                
                if (activeLinks.length === 0) {
                    linksContainer.innerHTML = `
                        <div class="empty-state">
                            <h3>Belum Ada ShortLink</h3>
                            <p>Anda belum membuat shortlink apapun.</p>
                            <p>Kunjungi halaman <a href="/create" style="color: #4facfe;">Buat ShortLink</a> untuk membuat yang pertama.</p>
                        </div>
                    `;
                    return;
                }
                
                linksContainer.innerHTML = `
                    <div class="links-grid">
                        ${activeLinks.map(link => `
                            <div class="link-card">
                                <div class="link-number">#${link.issueNumber}</div>
                                <div class="link-title">${link.title || 'Tidak ada judul'}</div>
                                ${link.description ? `<div class="link-description">${truncateText(link.description, 100)}</div>` : ''}
                                <div class="short-link">${BASE_URL}/${link.issueNumber}</div>
                                <div class="link-actions">
                                    <button class="action-btn copy-btn" onclick="copyToClipboard('${BASE_URL}/${link.issueNumber}')">
                                        ðŸ“‹ Salin
                                    </button>
                                    <button class="action-btn visit-btn" onclick="window.open('${BASE_URL}/${link.issueNumber}', '_blank')">
                                        ðŸ”— Kunjungi
                                    </button>
                                </div> 
<br>
<div class="link-date">${formatDate(link.createdAt)}</div>                   
                            </div>

                        `).join('')}
                    </div>
                `;
            }
            
            // Function to update stats
            function updateStats(links) {
                const activeLinks = links.filter(link => link.status === 'active').length;
                activeLinksCount.textContent = activeLinks;
            }
            
            // Function to format date
            function formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('id-ID', {
                    day: '2-digit',
                    month: 'short',
                    year: 'numeric'
                });
            }
            
            // Function to truncate text
            function truncateText(text, maxLength) {
                if (text.length <= maxLength) return text;
                return text.substring(0, maxLength) + '...';
            }
        });
        
        // Function to copy to clipboard
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('URL berhasil disalin!');
            }).catch(err => {
                alert('Gagal menyalin URL: ' + err);
            });
        }
        
        // Create background particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 20;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                
                const size = Math.random() * 4 + 1;
                const posX = Math.random() * 100;
                const posY = Math.random() * 100;
                const delay = Math.random() * 10;
                const duration = Math.random() * 15 + 5;
                
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${posX}%`;
                particle.style.top = `${posY}%`;
                particle.style.animation = `float ${duration}s ease-in-out ${delay}s infinite`;
                
                particlesContainer.appendChild(particle);
            }
        }
        
        // Initialize particles
        createParticles();
    </script>
</body>
</html>